/*
 * $Id: rawinflate.js,v 0.3 2013/04/09 14:25:38 dankogai Exp dankogai $
 *
 * GNU General Public License, version 2 (GPL-2.0)
 *   http://opensource.org/licenses/GPL-2.0
 * original:
 *   http://www.onicos.com/staff/iz/amuse/javascript/expert/inflate.txt
 */
;(function(e){var t=32768;var n=0;var r=1;var i=2;var s=9;var o=6;var u=32768;var a=64;var f;var l;var c=null;var h;var p,d;var v;var m;var g;var y;var b;var w;var E,S;var x,T;var N;var C;var k=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);var L=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0);var A=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99);var O=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577);var M=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var _=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var D=function(){this.next=null;this.list=null};var P=function(){this.e=0;this.b=0;this.n=0;this.t=null};var H=function(e,t,n,r,i,s){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;{var o;var u=new Array(this.BMAX+1);var a;var f;var l;var c;var h;var p;var d;var v=new Array(this.BMAX+1);var m;var g;var y;var b=new P;var w=new Array(this.BMAX);var E=new Array(this.N_MAX);var S;var x=new Array(this.BMAX+1);var T;var N;var C;var k;var L;L=this.root=null;for(h=0;h<u.length;h++)u[h]=0;for(h=0;h<v.length;h++)v[h]=0;for(h=0;h<w.length;h++)w[h]=null;for(h=0;h<E.length;h++)E[h]=0;for(h=0;h<x.length;h++)x[h]=0;a=t>256?e[256]:this.BMAX;m=e;g=0;h=t;do{u[m[g]]++;g++}while(--h>0);if(u[0]==t){this.root=null;this.m=0;this.status=0;return}for(p=1;p<=this.BMAX;p++)if(u[p]!=0)break;d=p;if(s<p)s=p;for(h=this.BMAX;h!=0;h--)if(u[h]!=0)break;l=h;if(s>h)s=h;for(N=1<<p;p<h;p++,N<<=1)if((N-=u[p])<0){this.status=2;this.m=s;return}if((N-=u[h])<0){this.status=2;this.m=s;return}u[h]+=N;x[1]=p=0;m=u;g=1;T=2;while(--h>0)x[T++]=p+=m[g++];m=e;g=0;h=0;do{if((p=m[g++])!=0)E[x[p]++]=h}while(++h<t);t=x[l];x[0]=h=0;m=E;g=0;c=-1;S=v[0]=0;y=null;C=0;for(;d<=l;d++){o=u[d];while(o-->0){while(d>S+v[1+c]){S+=v[1+c];c++;C=(C=l-S)>s?s:C;if((f=1<<(p=d-S))>o+1){f-=o+1;T=d;while(++p<C){if((f<<=1)<=u[++T])break;f-=u[T]}}if(S+p>a&&S<a)p=a-S;C=1<<p;v[1+c]=p;y=new Array(C);for(k=0;k<C;k++){y[k]=new P}if(L==null)L=this.root=new D;else L=L.next=new D;L.next=null;L.list=y;w[c]=y;if(c>0){x[c]=h;b.b=v[c];b.e=16+p;b.t=y;p=(h&(1<<S)-1)>>S-v[c];w[c-1][p].e=b.e;w[c-1][p].b=b.b;w[c-1][p].n=b.n;w[c-1][p].t=b.t}}b.b=d-S;if(g>=t)b.e=99;else if(m[g]<n){b.e=m[g]<256?16:15;b.n=m[g++]}else{b.e=i[m[g]-n];b.n=r[m[g++]-n]}f=1<<d-S;for(p=h>>S;p<C;p+=f){y[p].e=b.e;y[p].b=b.b;y[p].n=b.n;y[p].t=b.t}for(p=1<<d-1;(h&p)!=0;p>>=1)h^=p;h^=p;while((h&(1<<S)-1)!=x[c]){S-=v[c];c--}}}this.m=v[1];this.status=N!=0&&l!=1?1:0}};var B=function(){if(N.length==C)return-1;return N.charCodeAt(C++)&255};var j=function(e){while(m<e){v|=B()<<m;m+=8}};var F=function(e){return v&k[e]};var I=function(e){v>>=e;m-=e};var q=function(e,n,r){var i;var s;var o;if(r==0)return 0;o=0;for(;;){j(x);s=E.list[F(x)];i=s.e;while(i>16){if(i==99)return-1;I(s.b);i-=16;j(i);s=s.t[F(i)];i=s.e}I(s.b);if(i==16){l&=t-1;e[n+o++]=f[l++]=s.n;if(o==r)return r;continue}if(i==15)break;j(i);b=s.n+F(i);I(i);j(T);s=S.list[F(T)];i=s.e;while(i>16){if(i==99)return-1;I(s.b);i-=16;j(i);s=s.t[F(i)];i=s.e}I(s.b);j(i);w=l-s.n-F(i);I(i);while(b>0&&o<r){b--;w&=t-1;l&=t-1;e[n+o++]=f[l++]=f[w++]}if(o==r)return r}g=-1;return o};var R=function(e,n,r){var i;i=m&7;I(i);j(16);i=F(16);I(16);j(16);if(i!=(~v&65535))return-1;I(16);b=i;i=0;while(b>0&&i<r){b--;l&=t-1;j(8);e[n+i++]=f[l++]=F(8);I(8)}if(b==0)g=-1;return i};var U=function(e,t,n){if(c==null){var r;var i=new Array(288);var s;for(r=0;r<144;r++)i[r]=8;for(;r<256;r++)i[r]=9;for(;r<280;r++)i[r]=7;for(;r<288;r++)i[r]=8;p=7;s=new H(i,288,257,L,A,p);if(s.status!=0){alert("HufBuild error: "+s.status);return-1}c=s.root;p=s.m;for(r=0;r<30;r++)i[r]=5;zip_fixed_bd=5;s=new H(i,30,0,O,M,zip_fixed_bd);if(s.status>1){c=null;alert("HufBuild error: "+s.status);return-1}h=s.root;zip_fixed_bd=s.m}E=c;S=h;x=p;T=zip_fixed_bd;return q(e,t,n)};var z=function(e,t,n){var r;var i;var u;var a;var f;var l;var c;var h;var p=new Array(286+30);var d;for(r=0;r<p.length;r++)p[r]=0;j(5);c=257+F(5);I(5);j(5);h=1+F(5);I(5);j(4);l=4+F(4);I(4);if(c>286||h>30)return-1;for(i=0;i<l;i++){j(3);p[_[i]]=F(3);I(3)}for(;i<19;i++)p[_[i]]=0;x=7;d=new H(p,19,19,null,null,x);if(d.status!=0)return-1;E=d.root;x=d.m;a=c+h;r=u=0;while(r<a){j(x);f=E.list[F(x)];i=f.b;I(i);i=f.n;if(i<16)p[r++]=u=i;else if(i==16){j(2);i=3+F(2);I(2);if(r+i>a)return-1;while(i-->0)p[r++]=u}else if(i==17){j(3);i=3+F(3);I(3);if(r+i>a)return-1;while(i-->0)p[r++]=0;u=0}else{j(7);i=11+F(7);I(7);if(r+i>a)return-1;while(i-->0)p[r++]=0;u=0}}x=s;d=new H(p,c,257,L,A,x);if(x==0)d.status=1;if(d.status!=0){if(d.status==1);return-1}E=d.root;x=d.m;for(r=0;r<h;r++)p[r]=p[r+c];T=o;d=new H(p,h,0,O,M,T);S=d.root;T=d.m;if(T==0&&c>257){return-1}if(d.status==1){}if(d.status!=0)return-1;return q(e,t,n)};var W=function(){var e;if(f==null)f=new Array(2*t);l=0;v=0;m=0;g=-1;y=false;b=w=0;E=null};var X=function(e,r,i){var s,o;s=0;while(s<i){if(y&&g==-1)return s;if(b>0){if(g!=n){while(b>0&&s<i){b--;w&=t-1;l&=t-1;e[r+s++]=f[l++]=f[w++]}}else{while(b>0&&s<i){b--;l&=t-1;j(8);e[r+s++]=f[l++]=F(8);I(8)}if(b==0)g=-1}if(s==i)return s}if(g==-1){if(y)break;j(1);if(F(1)!=0)y=true;I(1);j(2);g=F(2);I(2);E=null;b=0}switch(g){case 0:o=R(e,r+s,i-s);break;case 1:if(E!=null)o=q(e,r+s,i-s);else o=U(e,r+s,i-s);break;case 2:if(E!=null)o=q(e,r+s,i-s);else o=z(e,r+s,i-s);break;default:o=-1;break}if(o==-1){if(y)return 0;return-1}s+=o}return s};var V=function(e){var t,n;W();N=e;C=0;var r=new Array(1024);var i=[];while((t=X(r,0,r.length))>0){var s=new Array(t);for(n=0;n<t;n++){s[n]=String.fromCharCode(r[n])}i[i.length]=s.join("")}N=null;return i.join("")};if(!e.RawDeflate)e.RawDeflate={};e.RawDeflate.inflate=V})(this)